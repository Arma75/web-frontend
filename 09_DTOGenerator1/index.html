<!DOCTYPE html>
<html lang="ko">
    <head>
        <title>üöÄ Bootceipt</title>

        <!-- Meta Tags -->
        <meta charset="UTF-8"/> <!-- Î¨∏Ïûê Ïù∏ÏΩîÎî© ÏÑ§Ï†ï -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <!-- Î∞òÏùëÌòï Ïõπ ÏÑ§Ï†ï -->
        <meta name="format-detection" content="telephone=no"/> <!-- Ï†ÑÌôîÎ≤àÌò∏ ÏûêÎèô Í∞êÏßÄ ÎπÑÌôúÏÑ±Ìôî -->
        <meta name="robots" content="index, follow"/> <!-- Í≤ÄÏÉâ ÏóîÏßÑ ÌÅ¨Î°§ÎßÅ ÏÑ§Ï†ï -->
        <meta name="title" content="DTO ÏÉùÏÑ±Í∏∞"/> <!-- Ï†úÎ™© ÏÑ§Ï†ï -->
        <meta name="description" content="DB ÌÖåÏù¥Î∏î Íµ¨Ï°∞Îßå ÏûÖÎ†•ÌïòÎ©¥ Spring Boot DTO ÏΩîÎìúÎ•º Ï¶âÏãú ÏÉùÏÑ±ÌïòÏÑ∏Ïöî. Lombok, Swagger, Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Î°úÏßÅ Î∞è PostgreSQL ÌäπÌôî ÌÉÄÏûÖ ÏôÑÎ≤Ω ÏßÄÏõê."/> <!-- ÏÑ§Î™Ö ÏÑ§Ï†ï -->
        <meta name="keywords" content="DTO ÏÉùÏÑ±Í∏∞, Java DTO Generator, Spring Boot DTO, PostgreSQL to Java, Lombok Generator, Ïò®ÎùºÏù∏ ÏΩîÎìú Ï†úÎÑ§Î†àÏù¥ÌÑ∞, ÏûêÎèôÌôî ÎèÑÍµ¨"/> <!-- ÌÇ§ÏõåÎìú ÏÑ§Ï†ï -->
        <meta name="author" content="attickok"/> <!-- ÏûëÏÑ±Ïûê ÏÑ§Ï†ï -->

        <!-- Open Graph Meta Tags(SNS Í≥µÏú†) -->
        <meta property="og:type" content="website" /> <!-- ÌÉÄÏûÖ ÏÑ§Ï†ï -->
        <meta property="og:title" content="DTO ÏÉùÏÑ±Í∏∞" /> <!-- Ï†úÎ™© ÏÑ§Ï†ï -->
        <meta property="og:description" content="DB ÌÖåÏù¥Î∏î Íµ¨Ï°∞Îßå ÏûÖÎ†•ÌïòÎ©¥ Spring Boot DTO ÏΩîÎìúÎ•º Ï¶âÏãú ÏÉùÏÑ±ÌïòÏÑ∏Ïöî. Lombok, Swagger, Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Î°úÏßÅ Î∞è PostgreSQL ÌäπÌôî ÌÉÄÏûÖ ÏôÑÎ≤Ω ÏßÄÏõê." /> <!-- ÏÑ§Î™Ö ÏÑ§Ï†ï -->
        <meta property="og:image" content="./assets/images/thumbnail.png" /> <!-- Ïù¥ÎØ∏ÏßÄ ÏÑ§Ï†ï -->
        <meta property="og:url" content="" /> <!-- URL ÏÑ§Ï†ï -->

        <!-- Progressive Web App -->
        <link rel="manifest" href="/manifest.json">

        <!-- Favicon Links -->
        <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicons/favicon-16x16.png"> <!-- 16x16 ÌååÎπÑÏΩò -->
        <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicons/favicon-32x32.png"> <!-- 32x32 ÌååÎπÑÏΩò -->
        <link rel="icon" type="image/png" sizes="64x64" href="./assets/favicons/favicon-64x64.png"> <!-- 64x64 ÌååÎπÑÏΩò -->
        <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicons/favicon-180x180.png"> <!-- Ïï†Ìîå ÌÑ∞Ïπò ÏïÑÏù¥ÏΩò -->

        <!-- CSS Stylesheet -->
        <link rel="stylesheet" href="./styles/main.css">
        <style>
            main {
                display: flex;
                flex-direction: column;
                gap: 36px;
            }

            .title-section {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }

            .project-section {
                display: flex;
                flex-direction: column;
                gap: 20px;
                background-color: #ffffff;
                border: 1px solid #f1f3f5;
                border-radius: 16px;
                padding: 24px;
            }

            .project-section > article {
                display: flex;
                flex-direction: column;
                justify-content: center;
                gap: 8px;
            }

            .options-section {
                display: flex;
                flex-direction: column;
                gap: 20px;
                background-color: #ffffff;
                border: 1px solid #f1f3f5;
                border-radius: 16px;
                padding: 24px;
            }

            .options-section > section {
                display: flex;
                flex-wrap: wrap;
                gap: 16px;
            }

            .options-section > section > label {
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                gap: 8px;
            }

            .table-section {
                display: flex;
                flex-direction: column;
                gap: 20px;
                background-color: #ffffff;
                border: 1px solid #f1f3f5;
                border-radius: 16px;
                padding: 24px;
            }

            .table-section > article {
                display: flex;
                flex-direction: column;
                justify-content: center;
                gap: 8px;
            }
            .table-section > .table-button-article {
                display: flex;
                flex-wrap: wrap;
                flex-direction: row;
                justify-content: flex-end;
                align-items: center;
            }
            .table-article {
                overflow: auto;
            }

            .generate-button-section {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                display: none;
            }

            .results-section {
                display: flex;
                flex-direction: column;
                gap: 20px;
                background-color: #ffffff;
                border: 1px solid #f1f3f5;
                border-radius: 16px;
                padding: 24px;
            }


            table {
                width: 100%;
                border-collapse: collapse;
                table-layout: fixed;/**/
            }
            thead {
                background-color: #f1f3f5;
                font-size: 0.875rem;
            }
            th, td {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                padding: 12px;
                text-align: center;
                vertical-align: middle;
            }
            tr {
                border-bottom: 1px solid #e9ecef;
            }
            tr:last-child {
                border-bottom: none;
            }

            table {
                min-width: 1320px;
            }
        </style>
    </head>

    <body>
        <template id="columnTemplate">
            <tr>
                <td>
                    <input type="checkbox" name="check"/>
                </td>
                <td>
                    <input type="text" name="name" data-field="name"/>
                </td>
                <td>
                    <input type="text" name="comment" data-field="comment"/>
                </td>
                <td>
                    <select name="type" data-field="type">
                        <option>SMALLINT</option>
                        <option>INTEGER</option>
                        <option>BIGINT</option>
                        <option>DECIMAL</option>
                        <option>NUMERIC</option>
                        <option>REAL</option>
                        <option>DOUBLE PRECISION</option>
                        <option>CHARACTER VARYING</option>
                        <option>VARCHAR</option>
                        <option>CHARACTER</option>
                        <option>CHAR</option>
                        <option>TEXT</option>
                        <option>TIME</option>
                        <option>DATE</option>
                        <option>TIMESTAMP</option>
                        <option>TIMESTAMP WITH TIME ZONE</option>
                        <option>TIMESTAMPTZ</option>
                        <option>BOOLEAN</option>
                        <option>UUID</option>
                        <option>JSON</option>
                        <option>JSONB</option>
                        <option>CREATE DATETIME</option>
                        <option>UPDATE DATETIME</option>
                        <option>LOGICAL USE</option>
                        <option>LOGICAL DELETE</option>
                    </select>
                </td>
                <td>
                    <input type="text" name="length" data-field="length"/>
                </td>
                <td>
                    <input type="checkbox" name="pk" data-field="pk"/>
                </td>
                <td>
                    <input type="checkbox" name="notNull" data-field="notNull"/>
                </td>
                <td>
                    <input type="checkbox" name="autoIncrease" data-field="autoIncrease"/>
                </td>
                <td>
                    <input type="text" name="defaultValue" data-field="defaultValue"/>
                </td>
            </tr>
        </template>

        <main>
            <section class="title-section">
                <h1>üöÄ Bootceipt</h1>
                <p>PostgreSQL Ïä§ÌÇ§ÎßàÎ•º Spring Boot DTOÎ°ú Ï¶âÏãú Î≥ÄÌôòÌïòÎäî ÏûêÎèôÌôî ÎèÑÍµ¨ÏûÖÎãàÎã§.</p>
            </section>

            <section class="project-section">
                <h2>Project</h2>

                <article>
                    <label for="teamName">TEAM</label>
                    <input type="text" id="teamName" value="team"/>
                </article>

                <article>
                    <label for="projectName">PROJECT</label>
                    <input type="text" id="projectName" value="demoProject"/>
                </article>

                <article>
                    <label for="dtoPostfix">POSTFIX</label>
                    <input type="text" id="dtoPostfix" value="DTO"/>
                </article>
            </section>

            <section class="options-section">
                <h2>Options</h2>
                <section>
                    <label><input type="checkbox" id="writeComment" data-field="writeComment"/> Comment</label>
                    <label><input type="checkbox" id="useSwagger" data-field="useSwagger"/> Swagger</label>
                    <label><input type="checkbox" id="useLombok" data-field="useLombok"/> Lombok</label>
                    <label><input type="checkbox" id="useDateRange" data-field="useDateRange"/> Date Range</label>
                </section>
            </section>

            <section class="table-section">
                <h2>TABLE</h2>

                <article>
                    <label for="tableName1">name</label>
                    <input type="text" id="tableName1"/>
                </article>

                <article>
                    <label for="tableComment1">comment</label>
                    <input type="text" id="tableComment1"/>
                </article>

                <hr/>

                <article class="table-button-article">
                    <button id="rowAddButton">add</button>
                    <button id="rowRemoveButton">remove</button>
                </article>

                <article class="table-article">
                    <table>
                        <colgroup>
                            <col width="44">
                            <col width="*">
                            <col width="*">
                            <col width="*">
                            <col width="*">
                            <col width="44">
                            <col width="92">
                            <col width="136">
                        </colgroup>
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="totalCheck"/>
                                </th>
                                <th>ÏïÑÏù¥Îîî</th>
                                <th>ÏΩîÎ©òÌä∏</th>
                                <th>ÌÉÄÏûÖ</th>
                                <th>Í∏∏Ïù¥</th>
                                <th>PK</th>
                                <th>NOT NULL</th>
                                <th>AUTO INCREASE</th>
                                <th>DEFAULT</th>
                            </tr>
                        </thead>
                        <tbody id="tableContent">
                        </tbody>
                    </table>
                </article>
            </section>

            <section class="generate-button-section">
                <button id="generate" class="primary">generate</button>
            </section>

            <section class="results-section">
                <h2>RESULTS</h2>
                <textarea id="textarea"></textarea>
            </section>
        </main>

        <!-- JavaScript -->
        <script src="./scripts/case-converter.js"></script>
        <script src="./scripts/json-to-java.js"></script>
        <script>
            function extractObjectFromElement(parentElement, keyAttr = 'name') {
                const data = {};
                const targetElements = parentElement.querySelectorAll(`[${keyAttr}]`);
                
                targetElements.forEach(element => {
                    const key = element.getAttribute(keyAttr);
                    const tagName = element.tagName.toLowerCase();
                    const type = element.type ? element.type.toLowerCase() : null;

                    let value = null;

                    if (tagName === 'input') {
                        if (type === 'checkbox') {
                            value = element.checked;
                        } else {
                            value = element.value;
                        }
                    } else if (tagName === 'select') {
                        value = element.value;
                    }

                    data[key] = value;
                });

                return data;
            }

            function bindMasterCheckbox(masterCheckbox, container, selector = 'input[type="checkbox"]') {
                masterCheckbox.addEventListener('change', (e) => {
                    const subCheckboxes = container.querySelectorAll(selector);
                    subCheckboxes.forEach(subCheckbox => {
                        subCheckbox.checked = e.target.checked;
                    });
                });

                container.addEventListener('change', e => {
                    if (e.target.matches(selector)) {
                        const subCheckboxes = container.querySelectorAll(selector);
                        const checkedSubCheckboxes = container.querySelectorAll(`${selector}:checked`);
                        
                        masterCheckbox.checked = (subCheckboxes.length > 0 && subCheckboxes.length === checkedSubCheckboxes.length);
                    }
                });
            }

            function addTemplate(template, target) {
                const clone = template.content.cloneNode(true);
                target.appendChild(clone);
            }

            bindMasterCheckbox(totalCheck, tableContent, `[name="check"]`);

            document.getElementById("rowAddButton").addEventListener('click', e => {
                addTemplate(document.getElementById("columnTemplate"), document.getElementById("tableContent"));

                totalCheck.checked = false;
            });

            document.getElementById("rowRemoveButton").addEventListener('click', e => {
                tableContent.querySelectorAll('[name="check"]:checked').forEach(elem => elem.closest('tr').remove());

                totalCheck.checked = false;
            });

            generate.onclick = generateFileContent;

            document.addEventListener('input', generateFileContent);
            document.addEventListener('change', generateFileContent);

            function generateFileContent() {
                let obj = {};
                obj.name = tableName1.value;
                obj.comment = tableComment1.value;
                obj.columns = [];
                [...document.querySelectorAll("tbody tr")].forEach(tr => {
                    let col = extractObjectFromElement(tr, "data-field");;
                    console.log(col);
                    obj.columns.push(col);
                });

                let table = new Table(obj);

                let project = new SpringBootProject({table : table});
                project.teamName = teamName.value;
                project.projectName = projectName.value;
                project.writeComment = writeComment.checked;
                project.useSwagger = useSwagger.checked;
                project.useLombok = useLombok.checked;
                project.dtoPostfix = dtoPostfix.value;
                project.useDateRange = useDateRange.checked;

                textarea.value = JavaConverter.toDTO(project);
            }
        </script>
    </body>
</html>

