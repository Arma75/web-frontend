<!DOCTYPE html>
<html lang="ko">
    <head>
        <title>üöÄ Bootceipt</title>

        <!-- Meta Tags -->
        <meta charset="UTF-8"/> <!-- Î¨∏Ïûê Ïù∏ÏΩîÎî© ÏÑ§Ï†ï -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <!-- Î∞òÏùëÌòï Ïõπ ÏÑ§Ï†ï -->
        <meta name="format-detection" content="telephone=no"/> <!-- Ï†ÑÌôîÎ≤àÌò∏ ÏûêÎèô Í∞êÏßÄ ÎπÑÌôúÏÑ±Ìôî -->
        <meta name="robots" content="index, follow"/> <!-- Í≤ÄÏÉâ ÏóîÏßÑ ÌÅ¨Î°§ÎßÅ ÏÑ§Ï†ï -->
        <meta name="title" content="DTO ÏÉùÏÑ±Í∏∞"/> <!-- Ï†úÎ™© ÏÑ§Ï†ï -->
        <meta name="description" content="DB ÌÖåÏù¥Î∏î Íµ¨Ï°∞Îßå ÏûÖÎ†•ÌïòÎ©¥ Spring Boot DTO ÏΩîÎìúÎ•º Ï¶âÏãú ÏÉùÏÑ±ÌïòÏÑ∏Ïöî. Lombok, Swagger, Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Î°úÏßÅ Î∞è PostgreSQL ÌäπÌôî ÌÉÄÏûÖ ÏôÑÎ≤Ω ÏßÄÏõê."/> <!-- ÏÑ§Î™Ö ÏÑ§Ï†ï -->
        <meta name="keywords" content="DTO ÏÉùÏÑ±Í∏∞, Java DTO Generator, Spring Boot DTO, PostgreSQL to Java, Lombok Generator, Ïò®ÎùºÏù∏ ÏΩîÎìú Ï†úÎÑ§Î†àÏù¥ÌÑ∞, ÏûêÎèôÌôî ÎèÑÍµ¨"/> <!-- ÌÇ§ÏõåÎìú ÏÑ§Ï†ï -->
        <meta name="author" content="attickok"/> <!-- ÏûëÏÑ±Ïûê ÏÑ§Ï†ï -->

        <!-- Open Graph Meta Tags(SNS Í≥µÏú†) -->
        <meta property="og:type" content="website" /> <!-- ÌÉÄÏûÖ ÏÑ§Ï†ï -->
        <meta property="og:title" content="DTO ÏÉùÏÑ±Í∏∞" /> <!-- Ï†úÎ™© ÏÑ§Ï†ï -->
        <meta property="og:description" content="DB ÌÖåÏù¥Î∏î Íµ¨Ï°∞Îßå ÏûÖÎ†•ÌïòÎ©¥ Spring Boot DTO ÏΩîÎìúÎ•º Ï¶âÏãú ÏÉùÏÑ±ÌïòÏÑ∏Ïöî. Lombok, Swagger, Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Î°úÏßÅ Î∞è PostgreSQL ÌäπÌôî ÌÉÄÏûÖ ÏôÑÎ≤Ω ÏßÄÏõê." /> <!-- ÏÑ§Î™Ö ÏÑ§Ï†ï -->
        <meta property="og:image" content="./assets/images/thumbnail.png" /> <!-- Ïù¥ÎØ∏ÏßÄ ÏÑ§Ï†ï -->
        <meta property="og:url" content="" /> <!-- URL ÏÑ§Ï†ï -->

        <!-- Progressive Web App -->
        <link rel="manifest" href="/manifest.json">

        <!-- Favicon Links -->
        <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicons/favicon-16x16.png"> <!-- 16x16 ÌååÎπÑÏΩò -->
        <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicons/favicon-32x32.png"> <!-- 32x32 ÌååÎπÑÏΩò -->
        <link rel="icon" type="image/png" sizes="64x64" href="./assets/favicons/favicon-64x64.png"> <!-- 64x64 ÌååÎπÑÏΩò -->
        <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicons/favicon-180x180.png"> <!-- Ïï†Ìîå ÌÑ∞Ïπò ÏïÑÏù¥ÏΩò -->

        <!-- CSS Stylesheet -->
        <link rel="stylesheet" href="./styles/main.css">
        <style>
        </style>
    </head>

    <body>
        <template id="columnTemplate">
            <tr>
                <td>
                    <input type="checkbox" name="check"/>
                </td>
                <td>
                    <input type="text" name="name" data-field="name"/>
                </td>
                <td>
                    <input type="text" name="comment" data-field="comment"/>
                </td>
                <td>
                    <select name="type" data-field="type">
                        <option>SMALLINT</option>
                        <option>INTEGER</option>
                        <option>BIGINT</option>
                        <option>DECIMAL</option>
                        <option>NUMERIC</option>
                        <option>REAL</option>
                        <option>DOUBLE PRECISION</option>
                        <option>CHARACTER VARYING</option>
                        <option>VARCHAR</option>
                        <option>CHARACTER</option>
                        <option>CHAR</option>
                        <option>TEXT</option>
                        <option>TIME</option>
                        <option>DATE</option>
                        <option>TIMESTAMP</option>
                        <option>TIMESTAMP WITH TIME ZONE</option>
                        <option>TIMESTAMPTZ</option>
                        <option>BOOLEAN</option>
                        <option>UUID</option>
                        <option>JSON</option>
                        <option>JSONB</option>
                        <option>CREATE DATETIME</option>
                        <option>UPDATE DATETIME</option>
                        <option>LOGICAL USE</option>
                        <option>LOGICAL DELETE</option>
                    </select>
                </td>
                <td>
                    <input type="number" name="length" data-field="length"/>
                </td>
                <td>
                    <input type="checkbox" name="pk" data-field="pk"/>
                </td>
                <td>
                    <input type="checkbox" name="notNull" data-field="notNull"/>
                </td>
                <td>
                    <input type="checkbox" name="autoIncrease" data-field="autoIncrease"/>
                </td>
                <td>
                    <input type="text" name="defaultValue" data-field="defaultValue"/>
                </td>
            </tr>
        </template>

        <main>
            <h1>üöÄ Bootceipt</h1>

            <h2>Project</h2>
            <label for="teamName">TEAM</label>
            <input type="text" id="teamName" value="team"/>
            <br/>
            <br/>
            <label for="projectName">PROJECT</label>
            <input type="text" id="projectName" value="demoProject"/>
            <br/>
            <br/>
            <label for="dtoPostfix">POSTFIX</label>
            <input type="text" id="dtoPostfix" value="DTO"/>
            <br/>
            <br/>
            <article>
                <label for="writeComment">comment</label><input type="checkbox" id="writeComment" data-field="writeComment"/>
                <br/>
                <br/>
                <label for="useSwagger">swagger</label><input type="checkbox" id="useSwagger" data-field="useSwagger"/>
                <br/>
                <br/>
                <label for="useLombok">lombok</label><input type="checkbox" id="useLombok" data-field="useLombok"/>
                <br/>
                <br/>
                <label for="useDateRange">date range</label><input type="checkbox" id="useDateRange" data-field="useDateRange"/>
            </article>
            <br/>
            <br/>
            <h2>TABLE</h2>
            <label for="tableName1">name</label><input type="text" id="tableName1"/>
            <br/>
            <br/>
            <label for="tableComment1">comment</label><input type="text" id="tableComment1"/>
            <br/>
            <br/>
            <button id="rowAddButton">add</button>
            <button id="rowRemoveButton">remove</button>
            <br/>
            <br/>
            <table>
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="totalCheck"/>
                        </th>
                        <th>ÏïÑÏù¥Îîî</th>
                        <th>ÏΩîÎ©òÌä∏</th>
                        <th>ÌÉÄÏûÖ</th>
                        <th>Í∏∏Ïù¥</th>
                        <th>PK</th>
                        <th>NOT NULL</th>
                        <th>AUTO INCREASE</th>
                        <th>DEFAULT</th>
                    </tr>
                </thead>
                <tbody id="tableContent">
                </tbody>
            </table>
            <br/>
            <br/>
            <button id="generate" class="primary">generate</button>
            <br/>
            <br/>
            <textarea id="textarea"></textarea>
        </main>

        <!-- JavaScript -->
        <script src="./scripts/case-converter.js"></script>
        <script src="./scripts/json-to-java.js"></script>
        <script>
            function extractObjectFromElement(parentElement, keyAttr = 'name') {
                const data = {};
                const targetElements = parentElement.querySelectorAll(`[${keyAttr}]`);
                
                targetElements.forEach(element => {
                    const key = element.getAttribute(keyAttr);
                    const tagName = element.tagName.toLowerCase();
                    const type = element.type ? element.type.toLowerCase() : null;

                    let value = null;

                    if (tagName === 'input') {
                        if (type === 'checkbox') {
                            value = element.checked;
                        } else {
                            value = element.value;
                        }
                    } else if (tagName === 'select') {
                        value = element.value;
                    }

                    data[key] = value;
                });

                return data;
            }

            function bindMasterCheckbox(masterCheckbox, container, selector = 'input[type="checkbox"]') {
                masterCheckbox.addEventListener('change', (e) => {
                    const subCheckboxes = container.querySelectorAll(selector);
                    subCheckboxes.forEach(subCheckbox => {
                        subCheckbox.checked = e.target.checked;
                    });
                });

                container.addEventListener('change', e => {
                    if (e.target.matches(selector)) {
                        const subCheckboxes = container.querySelectorAll(selector);
                        const checkedSubCheckboxes = container.querySelectorAll(`${selector}:checked`);
                        
                        masterCheckbox.checked = (subCheckboxes.length > 0 && subCheckboxes.length === checkedSubCheckboxes.length);
                    }
                });
            }

            function addTemplate(template, target) {
                const clone = template.content.cloneNode(true);
                target.appendChild(clone);
            }

            bindMasterCheckbox(totalCheck, tableContent, `[name="check"]`);

            document.getElementById("rowAddButton").addEventListener('click', e => {
                addTemplate(document.getElementById("columnTemplate"), document.getElementById("tableContent"));

                totalCheck.checked = false;
            });

            document.getElementById("rowRemoveButton").addEventListener('click', e => {
                tableContent.querySelectorAll('[name="check"]:checked').forEach(elem => elem.closest('tr').remove());

                totalCheck.checked = false;
            });

            generate.onclick = generateFileContent;

            document.addEventListener('input', generateFileContent);
            document.addEventListener('change', generateFileContent);

            function generateFileContent() {
                let obj = {};
                obj.name = tableName1.value;
                obj.comment = tableComment1.value;
                obj.columns = [];
                [...document.querySelectorAll("tbody tr")].forEach(tr => {
                    let col = extractObjectFromElement(tr, "data-field");;
                    console.log(col);
                    obj.columns.push(col);
                });

                let table = new Table(obj);

                let project = new SpringBootProject({table : table});
                project.teamName = teamName.value;
                project.projectName = projectName.value;
                project.writeComment = writeComment.checked;
                project.useSwagger = useSwagger.checked;
                project.useLombok = useLombok.checked;
                project.dtoPostfix = dtoPostfix.value;
                project.useDateRange = useDateRange.checked;

                textarea.value = JavaConverter.toDTO(project);
            }
        </script>
    </body>
</html>

